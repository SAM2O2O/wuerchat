
# api.register

站点对注册是有限制开关的，支持的配置类型如下：

* 是否开启实名制
* 是否开启邀请制
* 是否开启申请制（一期不支持）

邀请制与申请制是互斥关系，两者只能开启一个。

## 注册逻辑

1. 为用户生成一个site_user_id（对随机数进行sha1，site保证在site内部不重复）
2. 保存用户的公钥、头像、昵称等。

#### FAQ
1. 为什么不在平台生成一个公共的user-id，在site共用。
	- 如果这样的话，user-id必须来平台校验才知真假，site完全受控于平台。且平台要保存匿名用户的信息，无法全量保存，很有可能会删除无效数据，此操作会影响到site。

> 注册、登录是两个技术接口，用户的设备公钥、名称，在登录接口上传。

## 不要求实名
### 类型1：（实名制-NO，邀请制-NO，申请制-NO）

1. 执行注册逻辑。

### 类型2：（实名制-NO，邀请制-YES，申请制-NO）

1. 判断邀请码是否合法（未被占用）
2. 如合法，则执行注册逻辑。

### 类型3：（实名制-NO，邀请制-NO，申请制-YES）

1. 执行用户注册逻辑，并且标识为“待审批用户”。
	* 服务器端的所有逻辑，默认应该都是正式用户。
2. 管理员审批后，将审批结果发送给用户。
3. 如果审批通过，改变用户类别。


## 要求实名类别

与以上步骤相同，只是在用户注册之前，去平台通过用户公钥获取手机号。

1. 用户同意提供手机号。
2. 向平台申请一个手机号获取token。
3. 将token与其他信息一起发往站点服务器执行注册逻辑。
4. 站点服务器使用token、user-id-pubk去平台获取手机号。
